<!DOCTYPE html>
<html>

<head>
    <title>Expense tracker - Add transactions</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.2/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">
	<link rel="shortcut icon" href="" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>

<style>
    .toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
    }
</style>

<body>
    <script src="https://kit.fontawesome.com/86a2303dae.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <div class="wrapper d-flex align-items-stretch">
        {% include "navbar.html" %}
        <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">
            {% include "navbar2.html" %}
            <div class="container">
                <!-- Transaction Page -->
                <div class="transaction-page">
                    <h2>Add Transaction</h2>
                    <form id="transactionForm" class="form-control w-100" style="border: none;">
                        <div class="row d-flex">
                            <div class="col-md-6 col-sm-12">
                                <input type="text" class="form-control input" id="transactionName" placeholder="Transaction Name" required>
                            </div>
                            <div class="col-md-6 col-sm-12 justify-content-center">
                                <div class="mx-2 d-inline">
                                    <input type="radio" id="expenseRadio" name="transactionType" value="expense" checked>
                                    <label for="expenseRadio" class="radio-label input">Expense</label>
                                </div>
                                <div class="mx-2 d-inline">
                                    <input type="radio" id="incomeRadio" name="transactionType" value="income">
                                    <label for="incomeRadio" class="radio-label input">Income</label>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12 my-2">
                                <select class="form-control category-select" id="transactionCategory" required>
                                    <option value="" selected disabled>Select Type</option>
                                    <optgroup label="Expenses" id="expenseOptions">
                                        <option value="food"><i class="fas fa-utensils category-icon"></i>Food</option>
                                        <option value="bills"><i class="fas fa-file-invoice-dollar category-icon"></i>Bills</option>
                                        <option value="transportation"><i class="fas fa-bus category-icon"></i>Transportation</option>
                                        <option value="home"><i class="fas fa-home category-icon"></i>Home</option>
                                        <option value="car"><i class="fas fa-car category-icon"></i>Car</option>
                                        <option value="entertainment"><i class="fas fa-film category-icon"></i>Entertainment</option>
                                        <option value="shopping"><i class="fas fa-shopping-bag category-icon"></i>Shopping</option>
                                        <option value="clothing"><i class="fas fa-tshirt category-icon"></i>Clothing</option>
                                        <option value="insurance"><i class="fas fa-shield-alt category-icon"></i>Insurance</option>
                                        <option value="tax"><i class="fas fa-file-invoice category-icon"></i>Tax</option>
                                        <option value="telephone"><i class="fas fa-phone category-icon"></i>Telephone</option>
                                        <option value="health"><i class="fas fa-medkit category-icon"></i>Health</option>
                                        <option value="sport"><i class="fas fa-dumbbell category-icon"></i>Sport</option>
                                        <option value="baby"><i class="fas fa-baby category-icon"></i>Baby</option>
                                        <option value="pet"><i class="fas fa-paw category-icon"></i>Pet</option>
                                        <option value="beauty"><i class="fas fa-cut category-icon"></i>Beauty</option>
                                        <option value="gift"><i class="fas fa-gift category-icon"></i>Gift</option>
                                        <option value="social"><i class="fas fa-users category-icon"></i>Social</option>
                                        <option value="travel"><i class="fas fa-plane category-icon"></i>Travel</option>
                                        <option value="education"><i class="fas fa-graduation-cap category-icon"></i>Education</option>
                                        <option value="loan"><i class="fas fa-hand-holding-usd category-icon"></i>Loan</option>
                                        <option value="others"><i class="fas fa-question-circle category-icon"></i>Others</option>
                                        <!-- other expense options -->
                                    </optgroup>
                                    <optgroup label="Income" id="incomeOptions">
                                        <option value="salary"><i class="fas fa-wallet category-icon"></i>Salary</option>
                                        <option value="awards"><i class="fas fa-trophy category-icon"></i>Awards</option>
                                        <option value="grants"><i class="fas fa-hand-holding-usd category-icon"></i>Grants</option>
                                        <option value="rental"><i class="fas fa-house-user category-icon"></i>Rental</option>
                                        <option value="refunds"><i class="fas fa-undo category-icon"></i>Refunds</option>
                                        <option value="coupons"><i class="fas fa-tags category-icon"></i>Coupons</option>
                                        <option value="dividends"><i class="fas fa-chart-line category-icon"></i>Dividends</option>
                                        <option value="investment"><i class="fas fa-chart-pie category-icon"></i>Investment</option>
                                        <option value="others"><i class="fas fa-question-circle category-icon"></i>Others</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="col-md-6 col-sm-12 my-2">
                                <input type="date" class="form-control input" id="transactionDate" required>
                            </div>
                            <div class="col-md-6 col-sm-12 my-2">
                                <input type="number" class="form-control input" placeholder="Transaction amount" id="transactionAmount" required>
                            </div>
                            <div class="col-md-6 col-sm-12 my-2">
                                <button type="submit" class="btn btn-primary btn-block">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="toast-container">
        <div class="toast" id="successToast" role="alert" aria-live="assertive" aria-atomic="true"
            data-delay="2000">
            <div class="toast-header">
                <strong class="mr-auto">Success</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Transaction submitted successfully!
            </div>
        </div>
    </div>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.2/dist/sweetalert2.all.min.js"></script>
    <script>
        $(document).ready(function () {
            // Retrieve existing transaction data from local storage
            var transactions = JSON.parse(localStorage.getItem("transactions")) || [];

            // Function to save transaction data to local storage
            function saveTransaction(transaction) {
                transactions.push(transaction);
                localStorage.setItem("transactions", JSON.stringify(transactions));
            }

            // Function to retrieve all transaction data from local storage and update the history page
            function updateHistoryPage() {
                var historyData = JSON.parse(localStorage.getItem("transactions")) || [];

                var historyContainer = $("#historyContainer");
                historyContainer.empty();

                if (historyData.length === 0) {
                    historyContainer.append('<p>No transactions recorded.</p>');
                } else {
                    var historyList = $('<ul class="list-group"></ul>');
                    historyData.forEach(function (transaction) {
                        var listItem = $('<li class="list-group-item"></li>');
                        listItem.text(transaction.name + " - " + transaction.type + " - " + transaction.category + " - " + transaction.date + " - " + transaction.amount);
                        historyList.append(listItem);
                    });
                    historyContainer.append(historyList);
                }
            }

            function sendData(value) { 
                // var value = document.getElementByClassName('input').value; 
                $.ajax({ 
                    url: '/process', 
                    type: 'POST', 
                    data: { 'data': value }, 
                    success: function(response) { 
                        document.getElementById('output').innerHTML = response; 
                    }, 
                    error: function(error) { 
                        console.log(error); 
                    } 
                }); 
            }

            // Submit form event
            $("#transactionForm").submit(function (event) {
                event.preventDefault();

                // Get form values
                var transactionName = $("#transactionName").val();
                
                var transactionType = $('input[name="transactionType"]:checked').val();
                var transactionCategory = $("#transactionCategory").val();
                var transactionDate = $("#transactionDate").val();
                var transactionAmount = $("#transactionAmount").val();

                // Create transaction object
                var transaction = {
                    name: transactionName,
                    type: transactionType,
                    category: transactionCategory,
                    date: transactionDate,
                    amount: transactionAmount
                };

                console.log(transaction.name, transaction.type, transaction.category, transaction.date, transaction.amount);
                sendData(transaction);

                // Save transaction to local storage
                saveTransaction(transaction);

                // Show success toast
                $(".toast").toast("show");

                // Clear form inputs
                $("#transactionName").val("");
                $('input[name="transactionType"]').prop("checked", false);
                $("#transactionCategory").val("");
                $("#transactionDate").val("");
                $("#transactionAmount").val("");

                // Update history page
                updateHistoryPage();

                // also update current month's income and expense
                var currentMonth = new Date().toLocaleString('default', { month: 'long' });
                if (localStorage.getItem(currentMonth) === null) {
                    localStorage.setItem(currentMonth, JSON.stringify({
                        income: transactionType === "income" ? transactionAmount : 0,
                        expense: transactionType === "expense" ? transactionAmount : 0
                    }));
                } else {
                    var currentMonthData = JSON.parse(localStorage.getItem(currentMonth));
                    if (transactionType === "income") {
                        currentMonthData.income = parseInt(currentMonthData.income) + parseInt(transactionAmount);
                    } else if (transactionType === "expense") {
                        currentMonthData.expense = parseInt(currentMonthData.expense) + parseInt(transactionAmount);
                    }
                    localStorage.setItem(currentMonth, JSON.stringify(currentMonthData));
                }
            });

            // Show appropriate category options based on selected transaction type
            $('input[name="transactionType"]').change(function () {
                if (this.value === "expense") {
                    $("#expenseOptions").show();
                    $("#incomeOptions").hide();
                } else if (this.value === "income") {
                    $("#expenseOptions").hide();
                    $("#incomeOptions").show();
                }
            });

            // Initialize the toast
            $(".toast").toast({
                autohide: false
            });

            // Update history page on initial load
            updateHistoryPage();
        });
    

    </script>
</body>

</html>
